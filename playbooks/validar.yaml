---
- name: Gestionar contenedores
  hosts: all
  tasks:
    - name: Verificar si Podman está instalado
      command: which podman
      register: podman_check
      failed_when: false

    - name: Verificar si Docker está instalado
      command: which docker
      register: docker_check
      failed_when: false

    - name: Mostrar resultado de la verificación de Podman
      debug:
        msg: "Resultado de Podman: '{{ podman_check.stdout | trim }}'"

    - name: Mostrar resultado de la verificación de Docker
      debug:
        msg: "Resultado de Docker: '{{ docker_check.stdout | trim }}'"

    - name: Establecer gestor de contenedores
      set_fact:
        container_manager: >
          {% if podman_check.stdout | trim == '/usr/bin/podman' %}
            podman
          {% elif docker_check.stdout | trim == '/usr/bin/docker' %}
            docker
          {% else %}
            none
          {% endif %}
    - name: Validar si se encontró un gestor de contenedores
      fail:
        msg: "No se encontró Podman ni Docker en este servidor."
      when: container_manager == 'none'

    - name: Ejecutar rol de Docker
      include_role:
        name: docker
      when: container_manager == 'docker'